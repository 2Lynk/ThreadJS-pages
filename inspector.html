<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ThreadJS Example Mods</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Shared global stylesheet -->
  <link rel="stylesheet" href="https://2lynk.github.io/stylesheet.css">

  <!-- YAML & Markdown (for any descriptions you want to render later) -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Version helper (same as API Reference / Inspector) -->
  <script src="version.js"></script>
</head>
<body>
  <header>
    <div class="header-inner">

      <!-- Left: brand + Lynk pill -->
      <div style="display:flex; align-items:center; gap:0.75rem;">
        <a href="../" class="brand">
          <div class="brand-mark">T</div>
          <div class="brand-labels">
            <div class="brand-text-main">ThreadJS</div>
            <div class="brand-text-sub">Minecraft JS scripting</div>
          </div>
        </a>

        <!-- Back to main homepage -->
        <a class="nav-pill" href="https://2lynk.github.io/">Lynk</a>
      </div>

      <!-- Right: ThreadJS section navigation -->
      <nav class="nav-links">
        <a class="nav-pill" href="index.html">API Reference</a>
        <a class="nav-pill" href="inspector.html">Inspector</a>
        <a class="nav-pill nav-pill--accent" href="example-mods.html">Example Mods</a>
        <a class="nav-pill" href="designer.html">Designer</a>
      </nav>

    </div>
  </header>

  <!-- Version bar: wired to version.js, but used for example-mods -->
  <div class="version-bar">
    <label for="versionSelectMods">Version:</label>
    <select id="versionSelectMods" class="version-select"></select>
    <span id="versionNoteMods" class="version-note"></span>
  </div>

  <main>
    <div class="page-inner">
      <div class="page-heading">
        <h2>Example Mods</h2>
        <p>
          These example ThreadJS mods live in the
          <code>example-mods/&lt;version&gt;/</code> folder and are meant as
          copy-pasteable starting points. Pick a version in the bar above to see
          the examples that shipped with that API.
        </p>
      </div>

      <p class="hint">
        <strong>Tip:</strong> Click a filename link in a card to open the raw file on GitHub.
        You can drop these into your server’s <code>mods/threadjs</code> (or whatever path
        you use) and tweak them.
      </p>

      <div id="mods-grid" class="mods-grid"></div>

      <div id="mods-status" class="status">
        <span class="spinner"></span>
        Loading example mods…
      </div>
    </div>
  </main>

  <script>
    // --- Configuration for where example mods live ---
    const EXAMPLES_OWNER = "2Lynk";
    const EXAMPLES_REPO  = "ThreadJS-pages";  // repo that holds /example-mods
    const EXAMPLES_DIR   = "example-mods";    // root folder in that repo

    const modsGrid   = document.getElementById("mods-grid");
    const statusEl   = document.getElementById("mods-status");
    const noteElMods = document.getElementById("versionNoteMods");

    // Optional: per-file friendly descriptions
    const EXAMPLE_DESCRIPTIONS = {
      "admin-tools.js": "Admin-focused helpers: quick moderation commands, announcements, and small quality-of-life tools.",
      "hello-world.js": "Minimal ‘hello world’ style mod to show the basic ThreadJS lifecycle.",
      "events-demo.js": "Showcases event hooks and logging patterns in ThreadJS.",
      // Add more here as your example set grows
    };

    function setStatus(text, isError) {
      if (!statusEl) return;
      statusEl.textContent = text;
      statusEl.classList.toggle("error", !!isError);
    }

    function createElement(tag, className, text) {
      const el = document.createElement(tag);
      if (className) el.className = className;
      if (typeof text === "string") el.textContent = text;
      return el;
    }

    function clearGrid() {
      if (!modsGrid) return;
      modsGrid.innerHTML = "";
    }

    function renderExampleCard(versionId, fileMeta, fileText) {
      const fileName = fileMeta.name || "unknown.js";
      const path = fileMeta.path || "";
      const downloadUrl = fileMeta.download_url;

      const card = createElement("article", "mod-card");

      const header = createElement("div", "mod-card-header");
      const titleRow = createElement("div", "mod-title-row");

      const nameEl = createElement("div", "mod-name", fileName);
      titleRow.appendChild(nameEl);

      const badge = createElement("div", "mod-badge", versionId);
      titleRow.appendChild(badge);

      header.appendChild(titleRow);

      const pathEl = createElement("div", "mod-path", path);
      header.appendChild(pathEl);

      card.appendChild(header);

      const body = createElement("div", "mod-body");

      const desc = createElement(
        "div",
        "mod-description" + (EXAMPLE_DESCRIPTIONS[fileName] ? "" : " empty"),
        EXAMPLE_DESCRIPTIONS[fileName] || "No description yet for this example."
      );
      body.appendChild(desc);

      const codeWrapper = createElement("div", "mod-code-wrapper");
      const snippet = (fileText || "").trim();

      const pre = document.createElement("pre");
      pre.textContent = snippet;
      codeWrapper.appendChild(pre);

      body.appendChild(codeWrapper);

      const footer = createElement("div", "mod-footer");

      if (downloadUrl) {
        const link = document.createElement("a");
        link.href = downloadUrl;
        link.target = "_blank";
        link.rel = "noreferrer";
        link.textContent = "View raw on GitHub";
        footer.appendChild(link);
      }

      const meta = createElement(
        "div",
        "mod-meta",
        "Size: " + (fileMeta.size != null ? fileMeta.size + " bytes" : "unknown")
      );
      footer.appendChild(meta);

      body.appendChild(footer);

      card.appendChild(body);

      modsGrid.appendChild(card);
    }

    async function fetchExamplesForVersion(versionId) {
      clearGrid();
      setStatus("Loading example mods for " + versionId + "…");

      const apiUrl =
        "https://api.github.com/repos/" +
        encodeURIComponent(EXAMPLES_OWNER) + "/" +
        encodeURIComponent(EXAMPLES_REPO) + "/contents/" +
        encodeURIComponent(EXAMPLES_DIR) + "/" +
        encodeURIComponent(versionId);

      const res = await fetch(apiUrl);
      if (!res.ok) {
        throw new Error("GitHub API " + res.status + " for " + apiUrl);
      }

      const files = await res.json();
      if (!Array.isArray(files) || !files.length) {
        setStatus("No example mods found for " + versionId + ".", false);
        return;
      }

      // Only JS files
      const jsFiles = files.filter((f) =>
        f.type === "file" && /\.js$/i.test(f.name || "")
      );

      if (!jsFiles.length) {
        setStatus("No .js example mods found for " + versionId + ".", false);
        return;
      }

      // Fetch each file's content via download_url
      for (const fileMeta of jsFiles) {
        try {
          const url = fileMeta.download_url;
          if (!url) continue;

          const fileRes = await fetch(url);
          if (!fileRes.ok) {
            console.warn("Failed to fetch file", fileMeta.name, fileRes.status);
            continue;
          }
          const text = await fileRes.text();
          renderExampleCard(versionId, fileMeta, text);
        } catch (err) {
          console.warn("Error fetching example file", fileMeta.name, err);
        }
      }

      setStatus("Loaded " + jsFiles.length + " example mod(s) for " + versionId + ".", false);
    }

    // Wire the selector using version.js, but repurpose it for example-mods
    document.addEventListener("DOMContentLoaded", () => {
      if (!window.ThreadJsVersion || !window.ThreadJsVersion.initSelector) {
        setStatus("version.js not available – cannot pick version.", true);
        return;
      }

      ThreadJsVersion.initSelector({
        selectId: "versionSelectMods",
        noteId: "versionNoteMods",
        onReady(entry) {
          if (noteElMods) {
            noteElMods.textContent = "Showing example mods for " + entry.id;
          }
          fetchExamplesForVersion(entry.id)
            .catch((err) => {
              console.error(err);
              setStatus("Failed to load examples: " + err.message, true);
            });
        },
        onChange(entry) {
          if (noteElMods) {
            noteElMods.textContent = "Showing example mods for " + entry.id;
          }
          fetchExamplesForVersion(entry.id)
            .catch((err) => {
              console.error(err);
              setStatus("Failed to load examples: " + err.message, true);
            });
        }
      });
    });
  </script>
</body>
</html>
