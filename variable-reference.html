<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Variable Reference - ThreadJS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Shared global stylesheet -->
  <link rel="stylesheet" href="https://2lynk.github.io/stylesheet.css">
  
  <!-- YAML parsing library -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

  <style>
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    .intro {
      background: #e7f5ff;
      border-left: 4px solid #1971c2;
      padding: 1rem 1.25rem;
      margin-bottom: 2rem;
      border-radius: 6px;
    }

    .intro h2 {
      margin-top: 0;
      color: #1971c2;
      font-size: 1.25rem;
    }

    .intro p {
      margin-bottom: 0.5rem;
    }

    .intro code {
      background: #fff;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      font-size: 0.9rem;
    }

    .category {
      margin-bottom: 2.5rem;
    }

    .category-title {
      font-size: 1.5rem;
      color: #228be6;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #228be6;
    }

    .var-item {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .var-item h3 {
      margin: 0 0 0.5rem 0;
      color: #495057;
      font-size: 1.2rem;
      font-family: "Fira Code", monospace;
    }

    .var-desc {
      color: #6c757d;
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }

    .var-type {
      display: inline-block;
      background: #e9ecef;
      padding: 0.25rem 0.6rem;
      border-radius: 4px;
      font-size: 0.85rem;
      color: #495057;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .properties-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .properties-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }

    .properties-list li:last-child {
      border-bottom: none;
    }

    .prop-name {
      font-family: "Fira Code", monospace;
      color: #1971c2;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .prop-type {
      font-size: 0.8rem;
      color: #868e96;
      flex-shrink: 0;
    }

    .prop-desc {
      color: #495057;
      font-size: 0.9rem;
    }

    .example-box {
      background: #212529;
      color: #f8f9fa;
      padding: 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      font-family: "Fira Code", monospace;
      font-size: 0.85rem;
      overflow-x: auto;
    }

    .example-box .comment {
      color: #6c757d;
    }

    .example-box .keyword {
      color: #ff6b6b;
    }

    .example-box .string {
      color: #51cf66;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 1.5rem;
      color: #1971c2;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      main {
        padding: 0 1rem;
      }

      .category-title {
        font-size: 1.25rem;
      }

      .var-item {
        padding: 1rem;
      }

      .var-item h3 {
        font-size: 1rem;
      }

      .properties-list li {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .example-box {
        font-size: 0.75rem;
        padding: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.75rem;
      }

      .intro {
        padding: 0.75rem 1rem;
      }

      .intro h2 {
        font-size: 1.1rem;
      }

      .category-title {
        font-size: 1.1rem;
      }

      .var-item h3 {
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div style="display:flex; align-items:center; gap:0.75rem;">
        <a href="../" class="brand">
          <div class="brand-mark">T</div>
          <div class="brand-labels">
            <div class="brand-text-main">ThreadJS</div>
            <div class="brand-text-sub">Minecraft JS scripting</div>
          </div>
        </a>
        <a class="nav-pill" href="https://2lynk.github.io/">Lynk</a>
      </div>

      <nav class="nav-links">
        <a class="nav-pill" href="index.html">API Reference</a>
        <a class="nav-pill" href="inspector.html">Inspector</a>
        <a class="nav-pill" href="example-mods.html">Example Mods</a>
        <a class="nav-pill" href="designer.html">Designer</a>
        <a class="nav-pill nav-pill--accent" href="variable-reference.html">Variables</a>
      </nav>
    </div>
  </header>

  <main>
    <a href="designer.html" class="back-link">‚Üê Back to Designer</a>

    <h1>Variable Reference</h1>
    
    <div style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
      <label for="versionSelectVar" style="font-weight: 600; color: #495057;">Version:</label>
      <select id="versionSelectVar" style="padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 6px; font-size: 0.95rem;"></select>
      <span id="versionNoteVar" style="color: #6c757d; font-size: 0.9rem;"></span>
    </div>

    <div class="intro">
      <h2>üí° How to Use Variables in the Designer</h2>
      <p><strong>Direct Reference:</strong> Use <code>$variableName</code> to reference a variable directly</p>
      <p style="margin-left: 1.5rem;">Example: <code>"$player"</code> becomes <code>player</code></p>
      
      <p style="margin-top: 1rem;"><strong>Template Strings:</strong> Use <code>${variable.property}</code> to embed values in text</p>
      <p style="margin-left: 1.5rem;">Example: <code>"Welcome ${player.name}!"</code> becomes <code>`Welcome ${player.name}!`</code></p>
      
      <p style="margin-top: 1rem;"><strong>Autocomplete:</strong> Start typing in the Parameters JSON field and press Tab or Enter to complete</p>
    </div>

    <div id="variables-content">
      <!-- Content will be generated by JavaScript -->
    </div>
  </main>

  <script src="version.js"></script>
  <script>
    // Load variable schemas from versioned YAML files
    let currentVariableData = null;

    async function loadVariableSchema(yamlPath) {
      try {
        const response = await fetch(yamlPath);
        const yamlText = await response.text();
        const data = jsyaml.load(yamlText);
        currentVariableData = data;
        generateReferencePage(data);
      } catch (error) {
        console.error('Error loading variable schema:', error);
        document.getElementById('variables-content').innerHTML = 
          '<div style="color: red; padding: 2rem;">Error loading variable definitions. Please refresh the page.</div>';
      }
    }

    // Generate the reference page content
    function generateReferencePage(data) {
      if (!data || !data.categories) {
        console.error('Invalid variable data:', data);
        return;
      }
      const container = document.getElementById('variables-content');
      let html = '';

      // Build variables lookup for extends
      const allVariables = {};
      for (const category of data.categories) {
        for (const variable of category.variables) {
          allVariables[variable.name] = variable;
        }
      }

      for (const category of data.categories) {
        html += `<div class="category">`;
        html += `<h2 class="category-title">${category.name}</h2>`;
        if (category.description) {
          html += `<p style="color: #6c757d; margin-bottom: 1.5rem;">${category.description}</p>`;
        }

        for (const variable of category.variables) {
          // Handle extends
          let properties = variable.properties || [];
          if (variable.extends) {
            const baseVariable = allVariables[variable.extends];
            if (baseVariable && baseVariable.properties) {
              properties = [...baseVariable.properties, ...properties];
            }
          }

          html += `<div class="var-item">`;
          html += `<h3>${variable.name}</h3>`;
          
          if (variable.description) {
            html += `<div class="var-desc">${variable.description}</div>`;
          }

          if (variable.type) {
            html += `<div class="var-type">Type: ${variable.type}</div>`;
          }

          if (properties.length > 0) {
            html += '<ul class="properties-list">';
            for (const prop of properties) {
              const fullPath = prop.name.startsWith('[') ? `${variable.name}${prop.name}` : `${variable.name}.${prop.name}`;
              html += '<li>';
              html += `<span class="prop-name">${fullPath}</span>`;
              if (prop.type) html += `<span class="prop-type">${prop.type}</span>`;
              if (prop.description) html += `<span class="prop-desc">${prop.description}</span>`;
              html += '</li>';
            }
            html += '</ul>';
          }

          // Add examples if provided
          if (variable.examples && variable.examples.length > 0) {
            for (const example of variable.examples) {
              html += `<div class="example-box">`;
              if (example.label) {
                html += `<span class="comment">// ${example.label}</span>\n`;
              }
              html += example.code.trim();
              html += `</div>`;
            }
          }

          html += `</div>`;
        }

        html += `</div>`;
      }

      container.innerHTML = html;
    }

    // Initialize version selector
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initVariableReference);
    } else {
      initVariableReference();
    }

    function initVariableReference() {
      if (window.ThreadJsVersion && window.ThreadJsVersion.initSelector) {
        ThreadJsVersion.initSelector({
          selectId: "versionSelectVar",
          noteId: "versionNoteVar",
          filePattern: /^v[\d.]+\-variables\.(yaml|yml)$/,
          onReady(entry) {
            loadVariableSchema(entry.yamlPath);
          },
          onChange(entry) {
            loadVariableSchema(entry.yamlPath);
          }
        });
      } else {
        // Fallback: load default version
        loadVariableSchema('versions/v1.0.0-variables.yaml');
      }
    }
  </script>
</body>
</html>
