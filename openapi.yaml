openapi: 3.0.3
info:
  title: ThreadJS API Reference
  version: 1.0.0
  description: |
    **ThreadJS** is a powerful Minecraft Fabric mod that allows you to script Minecraft using JavaScript.
    
    Write your scripts in the `config/jsmods` folder and they'll be loaded automatically on server startup.
    Use `/threadjs reload` to hot-reload your scripts without restarting.
    
    ## Quick Start
    
    ```javascript
    // hello.js - runs on server startup
    api.log("Hello from ThreadJS!");
    
    api.onPlayerJoin(player => {
      api.sendMessage(`Welcome ${player.name}!`);
    });
    ```
    
    ## Features
    
    - üéÆ **Event System** - Listen to game events (player join, block break, etc.)
    - üéØ **Commands** - Register custom commands with tab completion
    - üåç **World Manipulation** - Edit blocks, spawn entities, teleport players
    - üîß **Player Management** - Modify health, gamemode, inventory
    - üì¶ **Mod System** - Create reusable JS modules with lifecycle hooks
    - üêõ **Debugging** - WebSocket debugger, inspect objects, breakpoints

tags:
  - name: Core
  - name: Messaging
  - name: Commands
  - name: Mods
  - name: Events
  - name: World
  - name: Players
  - name: Entities
  - name: Data
  - name: Scheduling
  - name: Debug

paths:
  /api/log:
    post:
      tags: [Core]
      summary: Log a message
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  oneOf:
                    - type: string
                    - type: object
                    - type: number
      responses:
        '200': { description: OK }

  /api/scriptsDir:
    get:
      tags: [Core]
      summary: Get scripts directory path
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  path: { type: string }

  /api/sendMessage:
    post:
      tags: [Messaging]
      summary: Broadcast message to all players
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message: { type: string }
      responses:
        '200': { description: OK }

  /api/sendMessageTo:
    post:
      tags: [Messaging]
      summary: Send message to specific player
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [target, message]
              properties:
                target: { type: string }
                message: { type: string }
      responses:
        '200': { description: OK }
        '404': { description: Not found }

  /api/registerCommand:
    post:
      tags: [Commands]
      summary: Register a custom command
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [name, handler]
              properties:
                name: { type: string }
                handler: { type: string }
                minPermissionLevel: { type: integer, minimum: 0, maximum: 4, default: 0 }
                playerOnly: { type: boolean, default: false }
                argSpec: { type: array, items: { type: string } }
      responses:
        '201': { description: Created }
        '400': { description: Bad Request }

  /api/registerMod:
    post:
      tags: [Mods]
      summary: Register a JavaScript mod
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [id, module]
              properties:
                id: { type: string }
                module:
                  type: object
                  properties:
                    onInitialize: { type: string }
                    onReload: { type: string }
      responses:
        '201': { description: Created }

  /api/events/serverTick:
    post:
      tags: [Events]
      summary: Register server tick handler
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                callback: { type: string }
      responses:
        '200': { description: OK }

  /api/events/playerJoin:
    post:
      tags: [Events]
      summary: Register player join handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PlayerEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/playerLeave:
    post:
      tags: [Events]
      summary: Register player leave handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PlayerEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/playerTick:
    post:
      tags: [Events]
      summary: Register player tick handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PlayerEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/chatMessage:
    post:
      tags: [Events]
      summary: Register chat message handler
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                callback: { type: string }
      responses:
        '200': { description: OK }

  /api/events/blockBreak:
    post:
      tags: [Events]
      summary: Register block break handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BlockEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/blockPlace:
    post:
    tags: [Events]
    summary: Register block place handler
    requestBody:
      content:
        application/json:
          schema: { $ref: '#/components/schemas/BlockEventHandler' }
    responses:
      '200': { description: OK }

  /api/events/useBlock:
    post:
      tags: [Events]
      summary: Register block use handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UseBlockEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/useItem:
    post:
      tags: [Events]
      summary: Register item use handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UseItemEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/attackEntity:
    post:
      tags: [Events]
      summary: Register attack entity handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AttackEntityEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/entityDamage:
    post:
      tags: [Events]
      summary: Register entity damage handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EntityDamageEventHandler' }
      responses:
        '200': { description: OK }

  /api/events/entityDeath:
    post:
      tags: [Events]
      summary: Register entity death handler
      requestBody:
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EntityDeathEventHandler' }
      responses:
        '200': { description: OK }

  /api/world/setBlock:
    post:
      tags: [World]
      summary: Set a block
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [x, y, z, dimensionId, blockId]
              properties:
                x: { type: integer }
                y: { type: integer }
                z: { type: integer }
                dimensionId: { type: string }
                blockId: { type: string }
      responses:
        '200': { description: OK }

  /api/world/getBlock:
    get:
      tags: [World]
      summary: Get block at position
      parameters:
        - name: x
          in: query
          required: true
          schema: { type: integer }
        - name: y
          in: query
          required: true
          schema: { type: integer }
        - name: z
          in: query
          required: true
          schema: { type: integer }
        - name: dimensionId
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/BlockSnapshot' }

  /api/world/fillArea:
    post:
      tags: [World]
      summary: Fill an area with blocks
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [x1, y1, z1, x2, y2, z2, dimensionId, blockId]
              properties:
                x1: { type: integer }
                y1: { type: integer }
                z1: { type: integer }
                x2: { type: integer }
                y2: { type: integer }
                z2: { type: integer }
                dimensionId: { type: string }
                blockId: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  blocksPlaced: { type: integer }

  /api/world/replaceBlocks:
    post:
      tags: [World]
      summary: Replace blocks in area
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [x1, y1, z1, x2, y2, z2, dimensionId, fromBlockId, toBlockId]
              properties:
                x1: { type: integer }
                y1: { type: integer }
                z1: { type: integer }
                x2: { type: integer }
                y2: { type: integer }
                z2: { type: integer }
                dimensionId: { type: string }
                fromBlockId: { type: string }
                toBlockId: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  blocksReplaced: { type: integer }

  /api/players/list:
    get:
      tags: [Players]
      summary: List all online players
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/PlayerState' }

  /api/players/teleport:
    post:
      tags: [Players]
      summary: Teleport a player
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [player, x, y, z, dimensionId]
              properties:
                player: { type: string }
                x: { type: number }
                y: { type: number }
                z: { type: number }
                dimensionId: { type: string }
      responses:
        '200': { description: OK }
        '404': { description: Not found }

  /api/players/setGamemode:
    post:
      tags: [Players]
      summary: Set player gamemode
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [player, mode]
              properties:
                player: { type: string }
                mode: { type: string, enum: [SURVIVAL, CREATIVE, ADVENTURE, SPECTATOR] }
      responses:
        '200': { description: OK }

  /api/players/setHealth:
    post:
      tags: [Players]
      summary: Set player health
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [player, health]
              properties:
                player: { type: string }
                health: { type: number, minimum: 0 }
      responses:
        '200': { description: OK }

  /api/players/heal:
    post:
      tags: [Players]
    summary: Heal a player
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [player, amount]
            properties:
              player: { type: string }
              amount: { type: number, minimum: 0 }
    responses:
      '200': { description: OK }

  /api/players/giveItem:
    post:
      tags: [Players]
      summary: Give item to player
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [player, itemId, count]
              properties:
                player: { type: string }
                itemId: { type: string }
                count: { type: integer, minimum: 1 }
      responses:
        '200': { description: OK }

  /api/players/playerSetPos:
    post:
      tags: [Players]
      summary: Set player position (PlayerState)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, x, y, z]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                x: { type: number }
                y: { type: number }
                z: { type: number }
      responses:
        '200': { description: OK }

  /api/players/playerTeleport:
    post:
      tags: [Players]
      summary: Teleport player (PlayerState)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, x, y, z, dimensionId]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                x: { type: number }
                y: { type: number }
                z: { type: number }
                dimensionId: { type: string }
      responses:
        '200': { description: OK }

  /api/players/playerSetHealth:
    post:
      tags: [Players]
      summary: Set PlayerState health
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, health]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                health: { type: number }
      responses:
        '200': { description: OK }

  /api/players/playerHeal:
    post:
      tags: [Players]
      summary: Heal PlayerState
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, amount]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                amount: { type: number }
      responses:
        '200': { description: OK }

  /api/players/playerSetGamemode:
    post:
      tags: [Players]
      summary: Set PlayerState gamemode
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, mode]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                mode: { type: string, enum: [SURVIVAL, CREATIVE, ADVENTURE, SPECTATOR] }
      responses:
        '200': { description: OK }

  /api/players/playerGiveItem:
    post:
      tags: [Players]
      summary: Give item to PlayerState
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, itemId, count]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                itemId: { type: string }
                count: { type: integer }
      responses:
        '200': { description: OK }

  /api/players/playerEquipArmor:
    post:
      tags: [Players]
      summary: Equip armor on PlayerState
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [playerState, armorSpec]
              properties:
                playerState: { $ref: '#/components/schemas/PlayerState' }
                armorSpec:
                  type: object
                  properties:
                    helmet: { type: string, nullable: true }
                    chestplate: { type: string, nullable: true }
                    leggings: { type: string, nullable: true }
                    boots: { type: string, nullable: true }
      responses:
        '200': { description: OK }

  /api/entities/spawn:
    post:
      tags: [Entities]
      summary: Spawn an entity
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [entityTypeId, x, y, z, dimensionId]
              properties:
                entityTypeId: { type: string }
                x: { type: number }
                y: { type: number }
                z: { type: number }
                dimensionId: { type: string }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  uuid: { type: string }

  /api/entities/kill:
    delete:
      tags: [Entities]
      summary: Kill an entity
      parameters:
        - name: entityId
          in: query
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: OK }
        '404': { description: Not found }

  /api/entities/find:
    post:
      tags: [Entities]
      summary: Find entities
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [center]
              properties:
                typeId: { type: string }
                center:
                  type: object
                  required: [x, y, z, dimensionId]
                  properties:
                    x: { type: number }
                    y: { type: number }
                    z: { type: number }
                    dimensionId: { type: string }
                radius: { type: number, default: 16 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/EntitySnapshot' }

  /api/data/load:
    get:
      tags: [Data]
      summary: Load persistent data
      parameters:
        - name: namespace
          in: query
          required: true
          schema: { type: string }
        - name: key
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { type: object }
        '404': { description: Not found }

  /api/data/save:
    post:
      tags: [Data]
      summary: Save persistent data
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [namespace, key, value]
              properties:
                namespace: { type: string }
                key: { type: string }
                value: { type: object }
      responses:
        '200': { description: OK }

  /api/scheduling/runLater:
    post:
      tags: [Scheduling]
      summary: Schedule delayed task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [ticks, callback]
              properties:
                ticks: { type: integer, minimum: 0 }
                callback: { type: string }
      responses:
        '200': { description: OK }

  /api/scheduling/runRepeating:
    post:
      tags: [Scheduling]
      summary: Schedule repeating task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [intervalTicks, callback]
              properties:
                intervalTicks: { type: integer, minimum: 1 }
                callback: { type: string }
      responses:
        '200': { description: OK }

  /api/debug/inspect:
    post:
      tags: [Debug]
      summary: Inspect an object
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                obj: {}
      responses:
        '200': { description: OK }

  /api/debug/describe:
    post:
      tags: [Debug]
      summary: Describe an object
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                obj: {}
      responses:
        '200': { description: OK }

  /api/debug/breakpoint:
    post:
      tags: [Debug]
      summary: Hit a breakpoint
      responses:
        '500': { description: Breakpoint thrown }

  /api/debug/setDebugLocal:
    post:
      tags: [Debug]
      summary: Configure debug output
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [debugLocal]
              properties:
                debugLocal: { type: boolean }
                logToPlayer: { type: boolean, default: false }
                playerName: { type: string, nullable: true }
      responses:
        '200': { description: OK }

  /api/debug/startDebugger:
    post:
      tags: [Debug]
      summary: Start WebSocket debugger
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                port: { type: integer, default: 31337, minimum: 1024, maximum: 65535 }
      responses:
        '200': { description: OK }

components:
  schemas:
    BlockSnapshot:
      type: object
      properties:
        blockId: { type: string }
        x: { type: integer }
        y: { type: integer }
        z: { type: integer }
        dimensionId: { type: string }

    PlayerState:
      type: object
      properties:
        _kind: { type: string }
        name: { type: string }
        uuid: { type: string, format: uuid }
        pos:
          type: array
          items: { type: number }
          minItems: 3
          maxItems: 3
        dimensionId: { type: string }
        gamemode: { type: string, nullable: true, enum: [SURVIVAL, CREATIVE, ADVENTURE, SPECTATOR] }
        health: { type: number }
        maxHealth: { type: number }
        xpLevel: { type: integer }
        xpProgress: { type: number }
        mainHand: { $ref: '#/components/schemas/ItemSummary' }
        offHand: { $ref: '#/components/schemas/ItemSummary' }
        inventory: { $ref: '#/components/schemas/InventorySummary' }

    ItemSummary:
      type: object
      properties:
        empty: { type: boolean }
        slot: { type: integer, nullable: true }
        count: { type: integer, nullable: true }
        itemId: { type: string, nullable: true }

    ArmorSummary:
      type: object
      properties:
        helmet: { $ref: '#/components/schemas/ItemSummary' }
        chestplate: { $ref: '#/components/schemas/ItemSummary' }
        leggings: { $ref: '#/components/schemas/ItemSummary' }
        boots: { $ref: '#/components/schemas/ItemSummary' }

    InventorySummary:
      type: object
      properties:
        size: { type: integer }
        nonEmpty: { type: integer }
        hotbar:
          type: array
          items: { $ref: '#/components/schemas/ItemSummary' }
        armor: { $ref: '#/components/schemas/ArmorSummary' }

    EntitySnapshot:
      type: object
      properties:
        uuid: { type: string, format: uuid }
        typeId: { type: string, nullable: true }
        name: { type: string }
        pos:
          type: array
          items: { type: number }
          minItems: 3
          maxItems: 3
        dimensionId: { type: string }

    CommandContext:
      type: object
      properties:
        name: { type: string }
        uuid: { type: string, format: uuid, nullable: true }
        dimensionId: { type: string }
        player:
          allOf:
            - $ref: '#/components/schemas/PlayerState'
            - nullable: true
        gameProfile: { type: object }
        reply: { type: string }

    BlockEvent:
      type: object
      properties:
        playerName: { type: string }
        uuid: { type: string, format: uuid }
        blockId: { type: string }
        x: { type: integer }
        y: { type: integer }
        z: { type: integer }
        dimensionId: { type: string }

    UseBlockEvent:
      type: object
      properties:
        playerName: { type: string }
        uuid: { type: string, format: uuid }
        hand: { type: string, enum: [MAIN_HAND, OFF_HAND] }
        blockId: { type: string }
        x: { type: integer }
        y: { type: integer }
        z: { type: integer }
        face: { type: string }
        dimensionId: { type: string }

    UseItemEvent:
      type: object
      properties:
        playerName: { type: string }
        uuid: { type: string, format: uuid }
        hand: { type: string, enum: [MAIN_HAND, OFF_HAND] }
        itemId: { type: string }
        itemCount: { type: integer }
        dimensionId: { type: string }

    AttackEntityEvent:
      type: object
      properties:
        playerName: { type: string }
        uuid: { type: string, format: uuid }
        hand: { type: string, enum: [MAIN_HAND, OFF_HAND] }
        targetType: { type: string }
        targetUuid: { type: string, format: uuid }
        dimensionId: { type: string }

    EntityDamageEvent:
      type: object
      properties:
        victimUuid: { type: string, format: uuid }
        victimType: { type: string }
        victimName: { type: string, nullable: true }
        amount: { type: number }
        sourceType: { type: string }
        attackerUuid: { type: string, format: uuid, nullable: true }
        dimensionId: { type: string }

    EntityDeathEvent:
      type: object
      properties:
        victimUuid: { type: string, format: uuid }
        victimType: { type: string }
        victimName: { type: string, nullable: true }
        killedBy: { type: string, nullable: true }
        dimensionId: { type: string }

    PlayerEventHandler:
      type: object
      properties:
        callback: { type: string }

    BlockEventHandler:
      type: object
      properties:
        callback: { type: string }

    UseBlockEventHandler:
      type: object
      properties:
        callback: { type: string }

    UseItemEventHandler:
      type: object
      properties:
        callback: { type: string }

    AttackEntityEventHandler:
      type: object
      properties:
        callback: { type: string }

    EntityDamageEventHandler:
      type: object
      properties:
        callback: { type: string }

    EntityDeathEventHandler:
      type: object
      properties:
        callback: { type: string }
